# Heimerdinger æŠ€æœ¯å¯è¡Œæ€§åˆ†ææ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

Heimerdinger æ˜¯ä¸€ä¸ª npm åŒ…å½¢å¼çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè¿æ¥ Slack/é£ä¹¦ç­‰ IM å·¥å…·ä¸ Claude Codeï¼Œå®ç°åœ¨èŠå¤©ä¸­è¿›è¡Œ vibe codingã€‚

### ä½¿ç”¨æ¨¡å¼

**å•ç”¨æˆ·éƒ¨ç½²æ¨¡å¼**: æ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œ Heimerdinger æœåŠ¡ï¼Œç”³è¯·è‡ªå·±çš„ Slack Botï¼Œå°† Bot çš„ webhook ç­‰ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°é…ç½®ä¸­ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼š
- ç”¨æˆ·æ‹¥æœ‰å®Œå…¨çš„æ•°æ®æ§åˆ¶æƒ
- æ— éœ€æ­å»ºå…¬å…±æœåŠ¡å™¨
- é…ç½®ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå®‰å…¨æ€§é«˜
- å¤©ç„¶æ”¯æŒä¸æœ¬åœ° Claude Code ä¼šè¯çš„äº’é€š

---

## æ ¸å¿ƒéœ€æ±‚åˆ†æ

### 1. CLI å‘½ä»¤è®¾è®¡

| å‘½ä»¤ | åŠŸèƒ½æè¿° |
|------|----------|
| `hmdg init` | åˆå§‹åŒ–é¡¹ç›®ï¼Œé€‰æ‹© IM å·¥å…·å¹¶é…ç½® |
| `hmdg config` | æŸ¥çœ‹/ä¿®æ”¹æœåŠ¡é…ç½® |
| `hmdg start` | å¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤åå°è¿è¡Œï¼‰ |
| `hmdg start --foreground` | å‰å°è¿è¡ŒæœåŠ¡ |
| `hmdg stop` | åœæ­¢æœåŠ¡ |
| `hmdg status` | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ |
| `hmdg projects` | åˆ—å‡ºæ‰€æœ‰å¯ç”¨é¡¹ç›® |
| `hmdg logs` | æŸ¥çœ‹æœåŠ¡æ—¥å¿— |

### 2. é…ç½®é¡¹è®¾è®¡

```typescript
interface HeimerdingerConfig {
  // æœåŠ¡é…ç½®
  server: {
    port: number;              // é»˜è®¤ 3150
    host: string;              // é»˜è®¤ '0.0.0.0'
    daemon: boolean;           // æ˜¯å¦åå°è¿è¡Œï¼Œé»˜è®¤ true
  };

  // Claude Code é…ç½®
  claude: {
    configPath: string;        // .claude.json è·¯å¾„ï¼Œé»˜è®¤ ~/.claude.json
    includeThinking: boolean;  // æ˜¯å¦è¿”å›æ€è€ƒè¿‡ç¨‹ï¼Œé»˜è®¤ true
    defaultModel: string;      // é»˜è®¤æ¨¡å‹
    timeout: number;           // å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  };

  // æƒé™é…ç½®
  permissions: {
    // é¢„ç½®ç™½åå•å·¥å…·
    allowedTools: string[];    // ä¾‹å¦‚: ['Read', 'Glob', 'Grep']
    // éœ€è¦ç¡®è®¤çš„å·¥å…·
    confirmTools: string[];    // ä¾‹å¦‚: ['Edit', 'Write', 'Bash']
    // ç¦æ­¢çš„å·¥å…·æ¨¡å¼
    blockedPatterns: string[]; // ä¾‹å¦‚: ['Bash(rm -rf*)', 'Bash(sudo*)']
    // ç¡®è®¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    confirmTimeout: number;    // é»˜è®¤ 60
    // è¶…æ—¶åçš„è¡Œä¸º
    timeoutAction: 'allow' | 'deny'; // é»˜è®¤ 'deny'
  };

  // å½“å‰ç›‘å¬çš„é¡¹ç›®ç›®å½•
  projectDir: string;

  // IM é€‚é…å™¨é…ç½®
  adapters: {
    [adapterName: string]: AdapterConfig;
  };

  // å½“å‰æ¿€æ´»çš„é€‚é…å™¨
  activeAdapter: string;

  // æ—¥å¿—é…ç½®
  logging: {
    level: 'debug' | 'info' | 'warn' | 'error';
    file: string;              // æ—¥å¿—æ–‡ä»¶è·¯å¾„
  };
}
```

---

## æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

### å…³é”®æŠ€æœ¯ç‚¹ 1: è¯»å– Claude Code é¡¹ç›®åˆ—è¡¨

**å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ**

Claude Code çš„é¡¹ç›®ä¿¡æ¯å­˜å‚¨åœ¨ `~/.claude.json` çš„ `projects` å­—æ®µï¼š

```json
{
  "projects": {
    "/home/dev/Code/project-a": { ... },
    "/home/dev/Code/project-b": { ... }
  }
}
```

åŒæ—¶ï¼Œæ¯ä¸ªé¡¹ç›®çš„ä¼šè¯å­˜å‚¨åœ¨ `~/.claude/projects/<encoded-path>/` ç›®å½•ä¸‹ï¼š
- `sessions-index.json` - åŒ…å«è¯¥é¡¹ç›®æ‰€æœ‰ä¼šè¯çš„ç´¢å¼•
- `<session-id>.jsonl` - æ¯ä¸ªä¼šè¯çš„è¯¦ç»†å†…å®¹

**å®ç°æ–¹æ¡ˆ**:
```typescript
// è¯»å–é¡¹ç›®åˆ—è¡¨ (ä½¿ç”¨ Bun API)
const claudeConfigPath = `${Bun.env.HOME}/.claude.json`;
const claudeConfig = await Bun.file(claudeConfigPath).json();
const projects = Object.keys(claudeConfig.projects);

// è¯»å–é¡¹ç›®ä¼šè¯åˆ—è¡¨
const projectPath = '/home/dev/Code/project-a';
const encodedPath = projectPath.replace(/\//g, '-').slice(1);
const sessionsIndexPath = `${Bun.env.HOME}/.claude/projects/${encodedPath}/sessions-index.json`;
const sessionsIndex = await Bun.file(sessionsIndexPath).json();
```

---

### å…³é”®æŠ€æœ¯ç‚¹ 2: æ¢å¤/ç»§ç»­ Claude Code ä¼šè¯

**å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ**

Claude Code CLI æä¾›äº†ä»¥ä¸‹å…³é”®å‚æ•°ï¼š

| å‚æ•° | åŠŸèƒ½ |
|------|------|
| `--resume <session-id>` | æ¢å¤æŒ‡å®šä¼šè¯ |
| `--continue` | ç»§ç»­æœ€è¿‘çš„ä¼šè¯ |
| `--session-id <uuid>` | ä½¿ç”¨æŒ‡å®šçš„ä¼šè¯ ID |
| `-p, --print` | éäº¤äº’æ¨¡å¼ï¼Œè¾“å‡ºç»“æœåé€€å‡º |
| `--output-format stream-json` | æµå¼ JSON è¾“å‡º |
| `--input-format stream-json` | æµå¼ JSON è¾“å…¥ |

**æ ¸å¿ƒå®ç°æ–¹æ¡ˆ**:
```bash
# æ¢å¤å·²æœ‰ä¼šè¯å¹¶æ‰§è¡Œæ–°æŒ‡ä»¤
claude -p --resume <session-id> --output-format stream-json "ä½ çš„æŒ‡ä»¤"

# åœ¨æŒ‡å®šé¡¹ç›®ç›®å½•ä¸‹ç»§ç»­æœ€è¿‘ä¼šè¯
cd /path/to/project && claude -p --continue --output-format stream-json "ä½ çš„æŒ‡ä»¤"

# åˆ›å»ºæ–°ä¼šè¯
cd /path/to/project && claude -p --output-format stream-json "ä½ çš„æŒ‡ä»¤"
```

**å…³é”®å‘ç°**:
- IM ç«¯å’Œå‘½ä»¤è¡Œç«¯å¯ä»¥å…±äº«åŒä¸€ä¸ª conversationï¼
- ä½¿ç”¨ `--resume <session-id>` å¯ä»¥æ¢å¤ä»»æ„å†å²ä¼šè¯
- ä¼šè¯æ–‡ä»¶æ˜¯ JSONL æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´å¯¹è¯å†å²

---

### å…³é”®æŠ€æœ¯ç‚¹ 3: å®æ—¶æµå¼è¾“å‡º

**å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ**

Claude Code æ”¯æŒ `--output-format stream-json`ï¼Œè¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼š

```json
{"type":"assistant","message":{"role":"assistant","content":"..."}}
{"type":"tool_use","tool":"Read","input":{...}}
{"type":"tool_result","output":"..."}
{"type":"result","subtype":"success","cost_usd":0.05}
```

**å®ç°æ–¹æ¡ˆ**:
```typescript
// ä½¿ç”¨ Bun.spawn() æ‰§è¡Œ Claude CLI
async function executeClaudeCommand(
  projectDir: string,
  prompt: string,
  sessionId?: string,
  onChunk: (chunk: any) => void
) {
  const args = ['-p', '--output-format', 'stream-json'];

  if (sessionId) {
    args.push('--resume', sessionId);
  }

  args.push(prompt);

  const proc = Bun.spawn(['claude', ...args], {
    cwd: projectDir,
    stdout: 'pipe',
    stderr: 'pipe',
  });

  // ä½¿ç”¨ ReadableStream å¤„ç†æµå¼è¾“å‡º
  const reader = proc.stdout.getReader();
  const decoder = new TextDecoder();
  let buffer = '';

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split('\n');
    buffer = lines.pop() || '';

    for (const line of lines) {
      if (line.trim()) {
        const chunk = JSON.parse(line);
        onChunk(chunk);
      }
    }
  }

  return proc;
}
```

---

### å…³é”®æŠ€æœ¯ç‚¹ 4: Slack é›†æˆ

**å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ**

Slack é›†æˆéœ€è¦ä»¥ä¸‹é…ç½®ï¼š

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `signingSecret` | Slack App Signing Secretï¼Œç”¨äºéªŒè¯è¯·æ±‚ |
| `botToken` | Bot User OAuth Token (xoxb-...) |
| `appToken` | App-Level Token (xapp-...)ï¼Œç”¨äº Socket Mode |
| `channelIds` | ç›‘å¬çš„é¢‘é“ ID åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |

**ä¸¤ç§é›†æˆæ¨¡å¼**:

1. **Socket Modeï¼ˆæ¨èï¼‰** - æ— éœ€å…¬ç½‘ IP
   - ä½¿ç”¨ `@slack/bolt` åº“
   - é€šè¿‡ WebSocket è¿æ¥ Slack
   - é€‚åˆå¼€å‘å’Œç§æœ‰éƒ¨ç½²

2. **HTTP Mode** - éœ€è¦å…¬ç½‘å¯è®¿é—®çš„ URL
   - é…ç½® Events API å’Œ Slash Commands
   - éœ€è¦è®¾ç½® webhook URL

**å®ç°æ–¹æ¡ˆ**:
```typescript
import { App } from '@slack/bolt';

const app = new App({
  token: config.slack.botToken,
  signingSecret: config.slack.signingSecret,
  socketMode: true,
  appToken: config.slack.appToken,
});

// ç›‘å¬ app_mention äº‹ä»¶
app.event('app_mention', async ({ event, say }) => {
  const prompt = event.text.replace(/<@[^>]+>/g, '').trim();
  // æ‰§è¡Œ Claude å‘½ä»¤å¹¶æµå¼è¿”å›
});

// ç›‘å¬ Slash å‘½ä»¤
app.command('/claude', async ({ command, ack, respond }) => {
  await ack();
  // æ‰§è¡Œ Claude å‘½ä»¤
});
```

---

### å…³é”®æŠ€æœ¯ç‚¹ 5: IM é€‚é…å™¨æ¨¡å¼è®¾è®¡

**å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ**

è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„é€‚é…å™¨æ¥å£ï¼Œä¾¿äºæ‰©å±•ï¼š

```typescript
// é€‚é…å™¨æ¥å£å®šä¹‰
interface IMAdapter {
  name: string;

  // åˆå§‹åŒ–é…ç½®
  init(): Promise<void>;

  // è·å–é…ç½®æ¨¡æ¿ï¼ˆç”¨äº hmdg initï¼‰
  getConfigTemplate(): ConfigField[];

  // éªŒè¯é…ç½®
  validateConfig(config: any): ValidationResult;

  // å¯åŠ¨é€‚é…å™¨
  start(): Promise<void>;

  // åœæ­¢é€‚é…å™¨
  stop(): Promise<void>;

  // å‘é€æ¶ˆæ¯åˆ° IM
  sendMessage(channel: string, message: string): Promise<void>;

  // æ›´æ–°æ¶ˆæ¯ï¼ˆç”¨äºæµå¼æ›´æ–°ï¼‰
  updateMessage(channel: string, messageId: string, message: string): Promise<void>;

  // æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
  onMessage(handler: MessageHandler): void;

  // æ³¨å†Œäº¤äº’å¤„ç†å™¨ï¼ˆæŒ‰é’®ç‚¹å‡»ç­‰ï¼‰
  onInteraction(handler: InteractionHandler): void;
}

// é…ç½®å­—æ®µå®šä¹‰
interface ConfigField {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'select';
  required: boolean;
  description: string;
  default?: any;
  options?: string[]; // for select type
  secret?: boolean;   // æ˜¯å¦æ•æ„Ÿä¿¡æ¯
}
```

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Heimerdinger                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CLI Layer (Commander.js)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  init    â”‚  config  â”‚  start   â”‚  stop    â”‚ projects â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Service Layer                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ClaudeCodeService                                       â”‚    â”‚
â”‚  â”‚  - executeCommand(prompt, options)                       â”‚    â”‚
â”‚  â”‚  - getProjects()                                         â”‚    â”‚
â”‚  â”‚  - getSessions(projectPath)                              â”‚    â”‚
â”‚  â”‚  - parseStreamOutput(data)                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ConfigManager                                           â”‚    â”‚
â”‚  â”‚  - loadConfig()                                          â”‚    â”‚
â”‚  â”‚  - saveConfig()                                          â”‚    â”‚
â”‚  â”‚  - validateConfig()                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SessionManager                                          â”‚    â”‚
â”‚  â”‚  - createSession()                                       â”‚    â”‚
â”‚  â”‚  - resumeSession()                                       â”‚    â”‚
â”‚  â”‚  - listSessions()                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Adapter Layer (Plugin Architecture)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  IMAdapterRegistry                                       â”‚    â”‚
â”‚  â”‚  - registerAdapter(adapter)                              â”‚    â”‚
â”‚  â”‚  - getAdapter(name)                                      â”‚    â”‚
â”‚  â”‚  - listAdapters()                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SlackAdapter â”‚  â”‚ LarkAdapter  â”‚  â”‚DiscordAdapterâ”‚          â”‚
â”‚  â”‚  (Phase 1)   â”‚  â”‚  (Phase 2)   â”‚  â”‚  (Future)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Message Handler Layer                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MessageProcessor                                        â”‚    â”‚
â”‚  â”‚  - parseCommand(message)                                 â”‚    â”‚
â”‚  â”‚  - handleProjectSelect()                                 â”‚    â”‚
â”‚  â”‚  - handleSessionSelect()                                 â”‚    â”‚
â”‚  â”‚  - handlePrompt()                                        â”‚    â”‚
â”‚  â”‚  - formatResponse()                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯æ ˆé€‰æ‹©

### æ ¸å¿ƒåŸåˆ™ï¼šBun ä¼˜å…ˆ

å°½å¯èƒ½ä½¿ç”¨ Bun å†…ç½®åŠŸèƒ½ï¼Œå‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–ã€‚

### Bun å†…ç½®åŠŸèƒ½ vs ç¬¬ä¸‰æ–¹åº“

| åŠŸèƒ½ | ä¼ ç»Ÿæ–¹æ¡ˆ | Bun å†…ç½® | æ˜¯å¦æ›¿ä»£ |
|------|----------|----------|----------|
| HTTP Server | Express/Hono | `Bun.serve()` | âœ… ä½¿ç”¨ Bun |
| è¿›ç¨‹è°ƒç”¨ | execa | `Bun.spawn()` | âœ… ä½¿ç”¨ Bun |
| æµ‹è¯•æ¡†æ¶ | vitest/jest | `bun:test` | âœ… ä½¿ç”¨ Bun |
| æ–‡ä»¶è¯»å†™ | fs/fs-extra | `Bun.file()` / `Bun.write()` | âœ… ä½¿ç”¨ Bun |
| æ„å»ºæ‰“åŒ… | rslib/tsup | `bun build` | âœ… ä½¿ç”¨ Bun |
| ç¯å¢ƒå˜é‡ | dotenv | å†…ç½® `.env` æ”¯æŒ | âœ… ä½¿ç”¨ Bun |

### æŠ€æœ¯æ ˆæ€»è§ˆ

| ç±»åˆ« | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| **è¿è¡Œæ—¶** | Bun | æ›¿ä»£ Node.jsï¼Œæ›´å¿«çš„å¯åŠ¨å’Œæ‰§è¡Œ |
| **æ„å»ºæ‰“åŒ…** | bun build | Bun å†…ç½® |
| **HTTP Server** | Bun.serve() | Bun å†…ç½® |
| **è¿›ç¨‹è°ƒç”¨** | Bun.spawn() | Bun å†…ç½® |
| **æµ‹è¯•æ¡†æ¶** | bun:test | Bun å†…ç½® |
| **CLI æ¡†æ¶** | Commander.js | æˆç†Ÿçš„ CLI æ„å»ºåº“ |
| **äº¤äº’æç¤º** | @clack/prompts | ç°ä»£åŒ– UIï¼Œä½“éªŒå¥½ |
| **Slack SDK** | @slack/bolt | å®˜æ–¹ Slack åº”ç”¨æ¡†æ¶ |
| **é…ç½®å­˜å‚¨** | conf | è·¨å¹³å°é…ç½®ç®¡ç† |
| **æ—¥å¿—** | consola | CLI å‹å¥½ï¼Œç¾åŒ–è¾“å‡º |
| **ä»£ç è´¨é‡** | Biome | æ›¿ä»£ ESLint + Prettier |

### Bun å†…ç½®åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

```typescript
// HTTP Server
Bun.serve({
  port: 3150,
  fetch(req) {
    const url = new URL(req.url);
    if (url.pathname === "/health") {
      return new Response("OK");
    }
    return new Response("Not Found", { status: 404 });
  },
});

// è¿›ç¨‹è°ƒç”¨ - æ‰§è¡Œ Claude CLI
const proc = Bun.spawn(
  ["claude", "-p", "--output-format", "stream-json", prompt],
  {
    cwd: projectDir,
    stdout: "pipe",
  }
);

// è¯»å–æµå¼è¾“å‡º
const reader = proc.stdout.getReader();
const decoder = new TextDecoder();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  const text = decoder.decode(value);
  // å¤„ç†è¾“å‡º...
}

// æ–‡ä»¶è¯»å†™
const config = await Bun.file("~/.heimerdinger/config.json").json();
await Bun.write("~/.heimerdinger/config.json", JSON.stringify(config, null, 2));

// æµ‹è¯•
import { test, expect, describe } from "bun:test";

describe("ConfigManager", () => {
  test("should load default config", () => {
    const config = new ConfigManager();
    expect(config.get("server.port")).toBe(3150);
  });
});
```

### ä¾èµ–æ¸…å•

```json
{
  "name": "heimerdinger",
  "type": "module",
  "dependencies": {
    "@slack/bolt": "^4.x",
    "commander": "^12.x",
    "@clack/prompts": "^0.7.x",
    "conf": "^13.x",
    "consola": "^3.x"
  },
  "devDependencies": {
    "@biomejs/biome": "^1.x",
    "@types/bun": "latest",
    "typescript": "^5.x"
  }
}
```

---

## IM äº¤äº’è®¾è®¡

### Slack äº¤äº’æµç¨‹

```
ç”¨æˆ·: @heimerdinger help
Bot:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– Heimerdinger - Claude Code Bridge   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨å‘½ä»¤:                               â”‚
â”‚ â€¢ /project - é€‰æ‹©é¡¹ç›®                   â”‚
â”‚ â€¢ /session - é€‰æ‹©/åˆ›å»ºä¼šè¯              â”‚
â”‚ â€¢ /status  - æŸ¥çœ‹å½“å‰çŠ¶æ€               â”‚
â”‚ â€¢ ç›´æ¥è¾“å…¥å†…å®¹å¼€å§‹å¯¹è¯                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·: /project
Bot:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ é€‰æ‹©é¡¹ç›®:                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [trading-platform] - /home/dev/Code/...â”‚
â”‚ [heimerdinger]     - /home/dev/Code/...â”‚
â”‚ [weaver]           - /home/dev/Code/...â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·: (ç‚¹å‡» trading-platform)
Bot:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å·²é€‰æ‹©é¡¹ç›®: trading-platform         â”‚
â”‚ ğŸ“ è·¯å¾„: /home/dev/Code/trading-platformâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ€è¿‘ä¼šè¯:                               â”‚
â”‚ [1] VSCodeé…ç½®ä¼˜åŒ– (Jan 4)              â”‚
â”‚ [2] DynamicConfigé‡æ„ (Dec 25)          â”‚
â”‚ [æ–°å»ºä¼šè¯]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·: å¸®æˆ‘æ£€æŸ¥ä¸€ä¸‹ src/utils ç›®å½•ä¸‹æœ‰æ²¡æœ‰æœªä½¿ç”¨çš„å‡½æ•°
Bot:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ æ­£åœ¨æ‰§è¡Œ...                          â”‚
â”‚                                        â”‚
â”‚ ğŸ’­ æ€è€ƒè¿‡ç¨‹:                            â”‚
â”‚ è®©æˆ‘å…ˆçœ‹çœ‹ src/utils ç›®å½•çš„ç»“æ„...       â”‚
â”‚                                        â”‚
â”‚ ğŸ“‚ è¯»å–æ–‡ä»¶: src/utils/index.ts         â”‚
â”‚ ...                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(å®æ—¶æ›´æ–°)
```

---

## é…ç½®æ–‡ä»¶è®¾è®¡

é…ç½®æ–‡ä»¶ä½ç½®: `~/.heimerdinger/config.json`

```json
{
  "version": "1.0.0",
  "server": {
    "port": 3150,
    "host": "0.0.0.0",
    "daemon": true
  },
  "claude": {
    "configPath": "~/.claude.json",
    "includeThinking": true,
    "defaultModel": "sonnet",
    "timeout": 300000
  },
  "permissions": {
    "allowedTools": ["Read", "Glob", "Grep", "WebFetch", "WebSearch"],
    "confirmTools": ["Edit", "Write", "Bash", "NotebookEdit"],
    "blockedPatterns": ["Bash(rm -rf*)", "Bash(sudo*)", "Bash(*credentials*)"],
    "confirmTimeout": 60,
    "timeoutAction": "deny"
  },
  "projectDir": "/home/dev/Code/my-project",
  "adapters": {
    "slack": {
      "enabled": true,
      "signingSecret": "xxx",
      "botToken": "xoxb-xxx",
      "appToken": "xapp-xxx",
      "socketMode": true
    }
  },
  "activeAdapter": "slack",
  "logging": {
    "level": "info",
    "file": "~/.heimerdinger/logs/app.log"
  }
}
```

---

## æ½œåœ¨æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### æŒ‘æˆ˜ 1: é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

**é—®é¢˜**: Claude Code æ‰§è¡Œå¤æ‚ä»»åŠ¡å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ŒSlack æ¶ˆæ¯æ›´æ–°æœ‰é€Ÿç‡é™åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ Slack çš„ Block Kit å®ç°è¿›åº¦æ¡
- æ‰¹é‡æ›´æ–°æ¶ˆæ¯ï¼Œé¿å…é¢‘ç¹ API è°ƒç”¨
- æ”¯æŒåå°è¿è¡Œï¼Œå®Œæˆåé€šçŸ¥ç”¨æˆ·

### æŒ‘æˆ˜ 2: ä¼šè¯çŠ¶æ€ç®¡ç†

**é—®é¢˜**: å¤šç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€é¡¹ç›®çš„ä¼šè¯ç®¡ç†ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ Redis/å†…å­˜å­˜å‚¨ç»´æŠ¤ç”¨æˆ·-é¡¹ç›®-ä¼šè¯æ˜ å°„
- å®ç°ä¼šè¯é”å®šæœºåˆ¶
- æä¾›ä¼šè¯åˆ‡æ¢æé†’

### æŒ‘æˆ˜ 3: å¤§é‡è¾“å‡ºå†…å®¹

**é—®é¢˜**: Claude è¾“å‡ºå¯èƒ½å¾ˆé•¿ï¼Œè¶…è¿‡ Slack æ¶ˆæ¯é™åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- æ™ºèƒ½æˆªæ–­ï¼Œä¿ç•™å…³é”®ä¿¡æ¯
- ä½¿ç”¨ Slack File Upload ä¸Šä¼ å®Œæ•´è¾“å‡º
- ä½¿ç”¨ Thread åˆ†æ®µæ˜¾ç¤º

### æŒ‘æˆ˜ 4: æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

**é—®é¢˜**: é¡¹ç›®ä»£ç å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- æ”¯æŒé…ç½®æ•æ„Ÿè·¯å¾„è¿‡æ»¤
- åœ¨è¾“å‡ºä¸­è‡ªåŠ¨è„±æ•
- æ”¯æŒç§æœ‰é¢‘é“/DM æ¨¡å¼

---

## æƒé™ç¡®è®¤æœºåˆ¶è®¾è®¡

### è®¾è®¡ç›®æ ‡

åœ¨ IM åœºæ™¯ä¸‹ï¼ŒClaude Code çš„äº¤äº’å¼æƒé™ç¡®è®¤æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚éœ€è¦è®¾è®¡ä¸€å¥—é€šè¿‡ IM è¿›è¡Œæƒé™ç¡®è®¤çš„æœºåˆ¶ã€‚

### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æƒé™ç¡®è®¤æµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ç”¨æˆ·è¯·æ±‚ â”€â”€> Claude æ‰§è¡Œ â”€â”€> éœ€è¦æƒé™? â”€â”€â”¬â”€â”€> å¦ â”€â”€> ç»§ç»­æ‰§è¡Œ       â”‚
â”‚                                          â”‚                          â”‚
â”‚                                          â””â”€â”€> æ˜¯ â”€â”€> åœ¨ç™½åå•ä¸­?    â”‚
â”‚                                                      â”‚              â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                          â”‚           â”‚           â”‚  â”‚
â”‚                                          â–¼           â–¼           â”‚  â”‚
â”‚                                         æ˜¯          å¦           â”‚  â”‚
â”‚                                          â”‚           â”‚           â”‚  â”‚
â”‚                                          â–¼           â–¼           â”‚  â”‚
â”‚                                      ç»§ç»­æ‰§è¡Œ   å‘é€ç¡®è®¤å¡ç‰‡      â”‚  â”‚
â”‚                                                      â”‚           â”‚  â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                          â”‚           â”‚           â”‚  â”‚
â”‚                                          â–¼           â–¼           â”‚  â”‚
â”‚                                        å…è®¸        æ‹’ç»          â”‚  â”‚
â”‚                                          â”‚           â”‚           â”‚  â”‚
â”‚                                          â–¼           â–¼           â”‚  â”‚
â”‚                                      ç»§ç»­æ‰§è¡Œ   ç»ˆæ­¢æ“ä½œ          â”‚  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®é¡¹

```typescript
interface PermissionConfig {
  // å·¥å…·ç™½åå• - è¿™äº›å·¥å…·æ— éœ€ç¡®è®¤
  allowedTools: string[];
  // ä¾‹å¦‚: ['Read', 'Glob', 'Grep', 'Bash(git:*)']

  // ç›®å½•ç™½åå• - åœ¨è¿™äº›ç›®å½•ä¸‹çš„æ“ä½œæ— éœ€ç¡®è®¤
  allowedPaths: string[];
  // ä¾‹å¦‚: ['/home/dev/Code/my-project/src']

  // é»˜è®¤æƒé™æ¨¡å¼
  defaultMode: 'ask' | 'allow' | 'deny';

  // æƒé™ç¡®è®¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  confirmationTimeout: number;
  // é»˜è®¤: 60

  // è¶…æ—¶åçš„é»˜è®¤è¡Œä¸º
  timeoutAction: 'allow' | 'deny';
  // é»˜è®¤: 'deny'
}
```

### Slack æƒé™ç¡®è®¤å¡ç‰‡è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ æƒé™ç¡®è®¤è¯·æ±‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Claude è¯·æ±‚æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š                                       â”‚
â”‚                                                                â”‚
â”‚ ğŸ”§ å·¥å…·: Bash                                                   â”‚
â”‚ ğŸ“ å‘½ä»¤: npm install lodash                                     â”‚
â”‚ ğŸ“ ç›®å½•: /home/dev/Code/my-project                              â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ’¡ æ­¤æ“ä½œå°†å®‰è£…æ–°çš„ npm ä¾èµ–åŒ…                             â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ âœ… å…è®¸     â”‚  â”‚ âŒ æ‹’ç»     â”‚  â”‚ âœ… å…è®¸å¹¶è®°ä½æ­¤ç±»æ“ä½œ  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚ â±ï¸ 60ç§’åè‡ªåŠ¨æ‹’ç»                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°æ–¹æ¡ˆ

```typescript
interface PermissionRequest {
  id: string;
  tool: string;
  input: any;
  description: string;
  timestamp: number;
  status: 'pending' | 'approved' | 'denied' | 'timeout';
}

class PermissionManager {
  private pendingRequests: Map<string, PermissionRequest> = new Map();
  private config: PermissionConfig;

  // æ£€æŸ¥æ˜¯å¦éœ€è¦æƒé™ç¡®è®¤
  async checkPermission(tool: string, input: any): Promise<boolean> {
    // 1. æ£€æŸ¥å·¥å…·ç™½åå•
    if (this.isToolAllowed(tool, input)) {
      return true;
    }

    // 2. æ£€æŸ¥è·¯å¾„ç™½åå•
    if (this.isPathAllowed(input)) {
      return true;
    }

    // 3. å‘é€ç¡®è®¤è¯·æ±‚
    return this.requestPermission(tool, input);
  }

  // å‘é€æƒé™ç¡®è®¤è¯·æ±‚åˆ° IM
  private async requestPermission(tool: string, input: any): Promise<boolean> {
    const request: PermissionRequest = {
      id: generateId(),
      tool,
      input,
      description: this.generateDescription(tool, input),
      timestamp: Date.now(),
      status: 'pending'
    };

    this.pendingRequests.set(request.id, request);

    // å‘é€ Slack å¡ç‰‡
    await this.adapter.sendPermissionCard(request);

    // ç­‰å¾…ç”¨æˆ·å“åº”æˆ–è¶…æ—¶
    return this.waitForResponse(request);
  }

  // å¤„ç†ç”¨æˆ·å“åº”
  handleResponse(requestId: string, approved: boolean, remember: boolean): void {
    const request = this.pendingRequests.get(requestId);
    if (request) {
      request.status = approved ? 'approved' : 'denied';

      // å¦‚æœç”¨æˆ·é€‰æ‹©"è®°ä½æ­¤ç±»æ“ä½œ"
      if (remember && approved) {
        this.addToWhitelist(request.tool, request.input);
      }
    }
  }
}
```

### ä¸ Claude CLI çš„é›†æˆ

**å…³é”®æŠ€æœ¯éªŒè¯ç»“æœ** âœ…

é€šè¿‡æµ‹è¯•å‘ç°ï¼ŒClaude CLI çš„è¾“å‡ºä¸­åŒ…å« `permission_denials` å­—æ®µï¼Œè®°å½•äº†æ‰€æœ‰è¢«æ‹’ç»çš„å·¥å…·è°ƒç”¨ï¼š

```json
{
  "type": "result",
  "permission_denials": [
    {
      "tool_name": "Bash",
      "tool_use_id": "toolu_xxx",
      "tool_input": {
        "command": "npm install lodash",
        "description": "Install lodash package"
      }
    }
  ]
}
```

è¿™ä¸ºæˆ‘ä»¬çš„æƒé™ç¡®è®¤æœºåˆ¶æä¾›äº†å®Œç¾çš„å®ç°è·¯å¾„ï¼

### æ¨èå®ç°æ–¹æ¡ˆ

**ä¸¤é˜¶æ®µæ‰§è¡Œç­–ç•¥**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸¤é˜¶æ®µæ‰§è¡Œæµç¨‹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  é˜¶æ®µ1: å—é™æ‰§è¡Œ                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ claude -p --allowed-tools "Read,Glob,Grep" "ç”¨æˆ·æŒ‡ä»¤"          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚ è§£æè¾“å‡ºä¸­çš„                 â”‚                        â”‚
â”‚              â”‚ permission_denials å­—æ®µ     â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                            â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                           â”‚                          â”‚
â”‚              â–¼                           â–¼                          â”‚
â”‚           æœ‰æ‹’ç»                       æ— æ‹’ç»                        â”‚
â”‚              â”‚                           â”‚                          â”‚
â”‚              â–¼                           â–¼                          â”‚
â”‚         å‘é€ç¡®è®¤å¡ç‰‡                  è¿”å›ç»“æœ                       â”‚
â”‚              â”‚                                                      â”‚
â”‚              â”‚                                                      â”‚
â”‚  é˜¶æ®µ2: å®Œæ•´æ‰§è¡Œï¼ˆç”¨æˆ·ç¡®è®¤åï¼‰                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ claude -p --allowed-tools "Read,Glob,Grep,Bash" "ç»§ç»­æ‰§è¡Œ"    â”‚  â”‚
â”‚  â”‚ --resume <session-id>                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°ä»£ç ç¤ºä¾‹

```typescript
interface PermissionDenial {
  tool_name: string;
  tool_use_id: string;
  tool_input: Record<string, any>;
}

interface ClaudeResult {
  type: 'result';
  subtype: 'success' | 'error';
  result: string;
  session_id: string;
  permission_denials?: PermissionDenial[];
}

async function executeWithPermissionFlow(
  prompt: string,
  projectDir: string,
  config: PermissionConfig
): Promise<void> {
  // é˜¶æ®µ1: ä½¿ç”¨ç™½åå•æ‰§è¡Œ
  const result = await executeClaudeCommand({
    prompt,
    projectDir,
    allowedTools: config.allowedTools,
    outputFormat: 'json'
  });

  // æ£€æŸ¥æ˜¯å¦æœ‰æƒé™æ‹’ç»
  if (result.permission_denials?.length > 0) {
    // å‘é€ç¡®è®¤å¡ç‰‡
    const confirmed = await sendPermissionConfirmationCard(
      result.permission_denials
    );

    if (confirmed) {
      // é˜¶æ®µ2: æ·»åŠ ç¡®è®¤çš„å·¥å…·åç»§ç»­æ‰§è¡Œ
      const confirmedTools = result.permission_denials.map(d => d.tool_name);
      const allTools = [...config.allowedTools, ...confirmedTools];

      await executeClaudeCommand({
        prompt: 'ç»§ç»­æ‰§è¡Œä¹‹å‰è¢«æ‹’ç»çš„æ“ä½œ',
        projectDir,
        sessionId: result.session_id,
        allowedTools: allTools,
        outputFormat: 'stream-json'
      });
    }
  }
}
```

### æƒé™é…ç½®åˆ†çº§

```typescript
// é…ç½®ç¤ºä¾‹
const permissionConfig = {
  // ç¬¬ä¸€çº§ï¼šå®Œå…¨å…è®¸çš„åªè¯»æ“ä½œ
  alwaysAllowed: ['Read', 'Glob', 'Grep', 'WebFetch', 'WebSearch'],

  // ç¬¬äºŒçº§ï¼šéœ€è¦ç¡®è®¤ä½†é£é™©è¾ƒä½çš„æ“ä½œ
  needsConfirmation: ['Edit', 'Write', 'Bash(git:*)'],

  // ç¬¬ä¸‰çº§ï¼šé«˜é£é™©æ“ä½œï¼Œæ¯æ¬¡éƒ½éœ€è¦ç¡®è®¤
  alwaysAsk: ['Bash', 'NotebookEdit'],

  // ç¬¬å››çº§ï¼šç¦æ­¢çš„æ“ä½œ
  neverAllowed: ['Bash(rm -rf*)', 'Bash(sudo*)']
};
```

---

## ä¼šè¯å…±äº«æœºåˆ¶è¯¦è§£

### æ ¸å¿ƒå‘ç°

Claude Code çš„ä¼šè¯æœºåˆ¶æ”¯æŒ IM ç«¯å’Œå‘½ä»¤è¡Œç«¯å…±äº«åŒä¸€ä¸ª conversationï¼š

1. **ä¼šè¯æ–‡ä»¶æ ¼å¼**: JSONL (JSON Lines)
2. **ä¼šè¯å­˜å‚¨ä½ç½®**: `~/.claude/projects/<encoded-path>/<session-id>.jsonl`
3. **ä¼šè¯ç´¢å¼•**: `sessions-index.json` è®°å½•æ‰€æœ‰ä¼šè¯å…ƒä¿¡æ¯

### å…±äº«ä¼šè¯çš„å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Slack ç”¨æˆ·     â”‚     â”‚   Heimerdinger  â”‚     â”‚   Claude Code   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  1. é€‰æ‹©é¡¹ç›®/ä¼šè¯     â”‚                       â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â”‚  2. å‘é€æç¤º          â”‚                       â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
         â”‚                       â”‚  3. claude -p         â”‚
         â”‚                       â”‚  --resume <session>   â”‚
         â”‚                       â”‚  --output-format json â”‚
         â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚  4. æµå¼è¾“å‡º          â”‚
         â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚  5. å®æ—¶æ›´æ–°æ¶ˆæ¯      â”‚                       â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
         â”‚                       â”‚                       â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                       â”‚
â”‚  å‘½ä»¤è¡Œç”¨æˆ·      â”‚              â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â”‚  6. claude --resume <same-session>           â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                       â”‚                       â”‚
         â”‚  7. ç»§ç»­åŒä¸€ä¸ªå¯¹è¯                            â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                       â”‚                       â”‚
```

### æŠ€æœ¯éªŒè¯

```bash
# éªŒè¯æ¢å¤ä¼šè¯å‘½ä»¤
claude -p --resume 10d8186b-613f-4b74-8bff-bdbd16349b47 \
  --output-format stream-json \
  "ç»§ç»­ä¸Šæ¬¡çš„å·¥ä½œ"
```

---

## TODO List

### Phase 1: åŸºç¡€æ¶æ„ (Week 1-2)

- [ ] é¡¹ç›®åˆå§‹åŒ–
  - [ ] åˆ›å»º Bun é¡¹ç›®ç»“æ„ (`bun init`)
  - [ ] é…ç½® TypeScript (`tsconfig.json`)
  - [ ] é…ç½® Biome (æ›¿ä»£ ESLint + Prettier)
  - [ ] é…ç½® `bun build` æ„å»ºè„šæœ¬
  - [ ] é…ç½® `bun:test` æµ‹è¯•

- [ ] CLI æ¡†æ¶æ­å»º
  - [ ] å®ç° Commander.js åŸºç¡€ç»“æ„
  - [ ] å®ç° `hmdg --help` å‘½ä»¤
  - [ ] å®ç° `hmdg --version` å‘½ä»¤
  - [ ] é…ç½® `bin` å…¥å£

- [ ] é…ç½®ç®¡ç†æ¨¡å—
  - [ ] å®ç° ConfigManager ç±»
  - [ ] ä½¿ç”¨ `Bun.file()` å®ç°é…ç½®è¯»å†™
  - [ ] å®ç°é…ç½®éªŒè¯
  - [ ] å®ç°é»˜è®¤é…ç½®

### Phase 2: æ ¸å¿ƒæœåŠ¡ (Week 2-3)

- [ ] Claude Code æœåŠ¡
  - [ ] å®ç° ClaudeCodeService ç±»
  - [ ] å®ç°è¯»å– .claude.json
  - [ ] å®ç°è·å–é¡¹ç›®åˆ—è¡¨
  - [ ] å®ç°è·å–ä¼šè¯åˆ—è¡¨
  - [ ] å®ç°æ‰§è¡Œ Claude å‘½ä»¤
  - [ ] å®ç°æµå¼è¾“å‡ºè§£æ

- [ ] ä¼šè¯ç®¡ç†
  - [ ] å®ç° SessionManager ç±»
  - [ ] å®ç°ä¼šè¯åˆ›å»º
  - [ ] å®ç°ä¼šè¯æ¢å¤
  - [ ] å®ç°ä¼šè¯åˆ—è¡¨

### Phase 3: é€‚é…å™¨æ¶æ„ (Week 3-4)

- [ ] é€‚é…å™¨æ¥å£
  - [ ] å®šä¹‰ IMAdapter æ¥å£
  - [ ] å®ç° AdapterRegistry
  - [ ] å®ç°é€‚é…å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

- [ ] Slack é€‚é…å™¨
  - [ ] å®ç° SlackAdapter ç±»
  - [ ] å®ç°é…ç½®æ¨¡æ¿
  - [ ] å®ç°æ¶ˆæ¯ç›‘å¬ (Socket Mode)
  - [ ] å®ç°æ¶ˆæ¯å‘é€
  - [ ] å®ç°æ¶ˆæ¯æ›´æ–°
  - [ ] å®ç°äº¤äº’ç»„ä»¶ (Button, Select)
  - [ ] å®ç° Slash Commands

### Phase 4: CLI å‘½ä»¤ (Week 4-5)

- [ ] `hmdg init` å‘½ä»¤
  - [ ] å®ç°é€‚é…å™¨é€‰æ‹©
  - [ ] å®ç°äº¤äº’å¼é…ç½®è¾“å…¥
  - [ ] å®ç°é…ç½®éªŒè¯å’Œä¿å­˜

- [ ] `hmdg config` å‘½ä»¤
  - [ ] å®ç°é…ç½®æŸ¥çœ‹
  - [ ] å®ç°é…ç½®ä¿®æ”¹
  - [ ] å®ç°é…ç½®é‡ç½®

- [ ] `hmdg start` å‘½ä»¤
  - [ ] å®ç°æœåŠ¡å¯åŠ¨
  - [ ] å®ç°åå°è¿è¡Œ (daemon)
  - [ ] å®ç° PID æ–‡ä»¶ç®¡ç†

- [ ] `hmdg stop` å‘½ä»¤
  - [ ] å®ç°ä¼˜é›…åœæ­¢
  - [ ] å®ç°å¼ºåˆ¶åœæ­¢

- [ ] `hmdg status` å‘½ä»¤
  - [ ] å®ç°æœåŠ¡çŠ¶æ€æŸ¥è¯¢
  - [ ] å®ç°è¿æ¥çŠ¶æ€æ˜¾ç¤º

- [ ] `hmdg projects` å‘½ä»¤
  - [ ] å®ç°é¡¹ç›®åˆ—è¡¨æ˜¾ç¤º
  - [ ] å®ç°é¡¹ç›®è¯¦æƒ…æŸ¥çœ‹

### Phase 5: æ¶ˆæ¯å¤„ç† (Week 5-6)

- [ ] æ¶ˆæ¯å¤„ç†å™¨
  - [ ] å®ç° MessageProcessor ç±»
  - [ ] å®ç°å‘½ä»¤è§£æ
  - [ ] å®ç°é¡¹ç›®é€‰æ‹©å¤„ç†
  - [ ] å®ç°ä¼šè¯é€‰æ‹©å¤„ç†
  - [ ] å®ç°æç¤ºè¯å¤„ç†

- [ ] å“åº”æ ¼å¼åŒ–
  - [ ] å®ç° Slack Block Kit æ ¼å¼åŒ–
  - [ ] å®ç°æ€è€ƒè¿‡ç¨‹æ ¼å¼åŒ–
  - [ ] å®ç°å·¥å…·è°ƒç”¨æ ¼å¼åŒ–
  - [ ] å®ç°é”™è¯¯æ ¼å¼åŒ–
  - [ ] å®ç°é•¿å†…å®¹å¤„ç†

- [ ] æƒé™ç¡®è®¤ç³»ç»Ÿ
  - [ ] å®ç° PermissionManager ç±»
  - [ ] å®ç°å·¥å…·ç™½åå•æ£€æŸ¥
  - [ ] å®ç°æƒé™ç¡®è®¤å¡ç‰‡ç”Ÿæˆ
  - [ ] å®ç°ç¡®è®¤å“åº”å¤„ç†
  - [ ] å®ç°è¶…æ—¶æœºåˆ¶
  - [ ] å®ç°"è®°ä½æ­¤æ“ä½œ"åŠŸèƒ½

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (Week 6-7)

- [ ] å•å…ƒæµ‹è¯• (ä½¿ç”¨ `bun:test`)
  - [ ] ConfigManager æµ‹è¯•
  - [ ] ClaudeCodeService æµ‹è¯•
  - [ ] SessionManager æµ‹è¯•
  - [ ] SlackAdapter æµ‹è¯•

- [ ] é›†æˆæµ‹è¯•
  - [ ] CLI å‘½ä»¤æµ‹è¯•
  - [ ] Slack é›†æˆæµ‹è¯•

- [ ] æ€§èƒ½ä¼˜åŒ–
  - [ ] æ¶ˆæ¯æ›´æ–°èŠ‚æµ
  - [ ] å¤§è¾“å‡ºå¤„ç†
  - [ ] å†…å­˜ä¼˜åŒ–

### Phase 7: æ–‡æ¡£ä¸å‘å¸ƒ (Week 7-8)

- [ ] æ–‡æ¡£
  - [ ] README.md
  - [ ] å®‰è£…æŒ‡å—
  - [ ] é…ç½®æŒ‡å—
  - [ ] Slack App åˆ›å»ºæŒ‡å—
  - [ ] API æ–‡æ¡£

- [ ] å‘å¸ƒ
  - [ ] npm åŒ…å‘å¸ƒ
  - [ ] GitHub Release
  - [ ] Changelog

---

## åç»­æ‰©å±•è®¡åˆ’

### Phase 2: é£ä¹¦é€‚é…å™¨
- é£ä¹¦å¼€æ”¾å¹³å°é›†æˆ
- é£ä¹¦æœºå™¨äºº API
- é£ä¹¦æ¶ˆæ¯å¡ç‰‡

### Phase 3: Discord é€‚é…å™¨
- Discord Bot API
- Discord Slash Commands

### Phase 4: é«˜çº§åŠŸèƒ½
- Web Dashboard
- å¤šç”¨æˆ·æƒé™ç®¡ç†
- ä»»åŠ¡é˜Ÿåˆ—
- Webhook é€šçŸ¥
- ä½¿ç”¨ç»Ÿè®¡

---

## ç»“è®º

è¯¥é¡¹ç›®æŠ€æœ¯ä¸Š**å®Œå…¨å¯è¡Œ**ã€‚æ ¸å¿ƒæŠ€æœ¯ç‚¹å·²éªŒè¯ï¼š

1. âœ… Claude Code çš„é¡¹ç›®å’Œä¼šè¯æ•°æ®å¯ä»¥è¯»å–
2. âœ… Claude CLI æ”¯æŒéäº¤äº’æ¨¡å¼å’Œæµå¼è¾“å‡º
3. âœ… å¯ä»¥é€šè¿‡ `--resume` æ¢å¤å†å²ä¼šè¯
4. âœ… IM ç«¯å’Œå‘½ä»¤è¡Œç«¯å¯ä»¥å…±äº«åŒä¸€ä¸ª conversation
5. âœ… Slack çš„ Socket Mode å¯ä»¥æ— éœ€å…¬ç½‘ IP è¿è¡Œ
6. âœ… å¯ä»¥é€šè¿‡ `--allowed-tools` å®ç°é¢„ç½®æƒé™ç™½åå•

ä¸»è¦å·¥ä½œé‡åœ¨äºï¼š
- é€‚é…å™¨æ¨¡å¼çš„æ¶æ„è®¾è®¡
- Slack Block Kit çš„æ¶ˆæ¯æ ¼å¼åŒ–
- æµå¼è¾“å‡ºçš„å®æ—¶æ›´æ–°ä¼˜åŒ–
- æƒé™ç¡®è®¤å¡ç‰‡äº¤äº’è®¾è®¡
- é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†

### å…³é”®æŠ€æœ¯é£é™©

| é£é™©ç‚¹ | é£é™©ç­‰çº§ | ç¼“è§£æ–¹æ¡ˆ |
|--------|----------|----------|
| @slack/bolt ä¸ Bun å…¼å®¹æ€§ | ä¸­ | éœ€è¦å®é™…æµ‹è¯•éªŒè¯ï¼Œå¦‚æœ‰é—®é¢˜å¯è€ƒè™‘é™çº§åˆ° Node.js æˆ–ä½¿ç”¨ Slack Web API |
| æƒé™ç¡®è®¤æ‹¦æˆª | ä¸­ | ä½¿ç”¨ `--allowed-tools` é¢„é…ç½®ç™½åå•ï¼Œéç™½åå•æ“ä½œå‰å‘é€ç¡®è®¤è¯·æ±‚ |
| Slack æ¶ˆæ¯æ›´æ–°é¢‘ç‡é™åˆ¶ | ä½ | å®ç°æ¶ˆæ¯æ›´æ–°èŠ‚æµï¼Œæ‰¹é‡æ›´æ–° |
| é•¿æ—¶é—´ä»»åŠ¡è¶…æ—¶ | ä½ | å®ç°åå°ä»»åŠ¡é˜Ÿåˆ—ï¼Œå®Œæˆåé€šçŸ¥ |
| å¤§è¾“å‡ºå¤„ç† | ä½ | æ™ºèƒ½æˆªæ–­ + æ–‡ä»¶ä¸Šä¼  |
